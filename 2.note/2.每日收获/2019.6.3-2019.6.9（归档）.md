# 2019.6.3 - 2019.6.9（归档）

### 2019.6.3

---

##### 收获一

- 需求：调用打印特定区域（就是特定标签内）的内容，例如打印 body下面 id为 con 标签里面的内容

---

##### 解决过程

- 第一步：首先是用原生的方法 print()，但是有 css 样式打印不出来的问题
- 第二步：寻找第三方库，找到一个叫做 print-js的库，但是可惜，在 vue-cli3.0 下，打包出的css都散成一块块的，于是样式也是打印不出来（但是自己试验的样式可以显示出来，整体来说比第一步有了提升）
- 第三步：将区域内容转为 图片，采用 html2canvas 这个库，实际结果可行（图片有部分偏差但是不影响）

```javascript

// html2canvas已经挂到了window上

function downloadClick() { // 下载按钮点击触发

    html2canvas(document.querySelector("#downloadImgMain"), {
        allowTaint: true, //允许污染
        taintTest: true, //在渲染前测试图片(没整明白有啥用)
        useCORS: true, //使用跨域(当allowTaint为true时这段代码没什么用)

    }).then(canvas => {
        // 下载
        let type = 'png';   //设置下载图片的格式
        let img_png_src = canvas.toDataURL("image/png");  //将canvas保存为图片
        let imgData = img_png_src.replace(imgType(type),'image/octet-stream');
        let filename = '图片' + '.' + type; //下载图片的文件名
        saveFile(imgData, filename);
    });
}

function imgType (ty) {
  let type = ty.toLowerCase().replace(/jpg/i, 'jpeg');
  let r = type.match(/png|jpeg|bmp|gif/)[0];
  return 'image/' + r;
}

function saveFile (data, fileName) {
  let save_link = document.createElement('a');
  save_link.href = data;
  save_link.download = fileName;
  let event = document.createEvent('MouseEvents');
  event.initEvent("click", true, false);
  save_link.dispatchEvent(event);
};
```

---

### 2019.6.4

##### 收获一：主要是将 GitHub/notes 项目完善了一下

- 整理了 正则表达式速查
- 完善了 notes的整体结构布局
- 尝试了社区的一些功能（后来又取消了）

---

### 2019.6.5

##### BUG记录：工作中遇到一个bug，记录下，不是什么问题，但是我没看到，所以我记录一下（2019.6.5 11:46）

```javascript

// 抽象出来就是这个意思
let obj = {}
obj['a']['b'] = 1; // 报错

// 解决目前就是给 obj.a = {}

```

---


### 2019.6.8

今天主要干了两件事情：

##### 1.梳理了VuePress的规则，知道怎么配置多个侧边栏

```javascript
module.exports = {
  // base: '/documents/',
  title: 'Notes',
  description: '知识速查（了不起的个人工具库',
  head: [
    ['link', { rel: 'icon', href: `/favicon.ico` }]
  ],
  themeConfig: {
    repo: 'https://github.com/zhukunpenglinyutong/notes',
    //导航
    nav: [
      { text: '速查', link: '/1.quickcheck/' },
      { text: '笔记', link: '/2.note/' },
      // { text: '常用网站', link: '/webtool/' }
    ],
    // 侧边栏
    sidebar: {
      '/1.quickcheck': [
        {
          title: '1.前端',
          children: [
            '/1.quickcheck/1.前端/1.HTML速查.md',
            '/1.quickcheck/1.前端/2.CSS速查.md',
            '/1.quickcheck/1.前端/3.JS方法速查.md'
          ]
        },
        {
          title: '2.后端',
          children: [
            '/1.quickcheck/2.后端/1.Node速查.md',
            '/1.quickcheck/2.后端/2.MySQL速查.md',
            '/1.quickcheck/2.后端/3.Express速查.md',
            '/1.quickcheck/2.后端/4.MongoDB速查.md'
          ]
        },
        {
          title: '3.运维',
          children: [
            '/1.quickcheck/3.运维/1.Centos下安装各种软件.md',
            '/1.quickcheck/3.运维/2.Nginx速查.md',
            '/1.quickcheck/3.运维/3.pm2常用命令.md',
            '/1.quickcheck/3.运维/4.Docker速查.md'
          ]
        },
        {
          title: '4.其他',
          children: [
            '/1.quickcheck/4.其他/1.正则表达式速查.md',
            '/1.quickcheck/4.其他/2.GitHub平台.md',
            '/1.quickcheck/4.其他/3.http协议速查.md',
            '/1.quickcheck/4.其他/4.微信小程序知识速查.md',
            '/1.quickcheck/4.其他/5.前端安全速查.md',
            '/1.quickcheck/4.其他/6.Electron速查.md',
            '/1.quickcheck/4.其他/7.VuePress速查.md',
          ]
        },
      ],
      '/2.note': [
        {
          title: '0.项目方向指南',
          children: [
            '/2.note/0.项目方向指南/v0.1方向指南',
            '/2.note/0.项目方向指南/v0.2方向指南'
          ]
        },
        {
          title: '1.每日规划',
          children: [
            '/2.note/1.每日规划/2019.6.4.md',
            '/2.note/1.每日规划/2019.6.5',
            '/2.note/1.每日规划/2019.6.7',
            '/2.note/1.每日规划/2019.6.8',
          ]
        },
        {
          title: '2.每日收获',
          children: [
            '/2.note/2.每日收获/2019.6.3',
            '/2.note/2.每日收获/2019.6.4',
            '/2.note/2.每日收获/2019.6.5'
          ]
        },
        {
          title: '3.面试总结',
          children: [
            '/2.note/3.面试总结/1.公司'
          ]
        },
        {
          title: '4.Typescript',
          children: [
            '/2.note/4.Typescript/1.概述'
          ]
        }
      ]
    }
  },
  serviceWorker: true,
}
```


##### 2.写了Node程序，解放了自己大部分的生产力（node程序还可以进行优化）


```javascript
var fs = require("fs");
var path = require('path')

// ① ：将 record.md 内容复制到 1.quickcheck 和 2.note下，并且名字都叫做 README.md

// 异步读取
fs.readFile('record.md', function (err, data) {
  
  if (err) {
      return console.error(err);
  }
  // console.log("异步读取: " + data.toString());

  // 异步写入
  fs.writeFile('./docs/1.quickcheck/README.md', data,  function(err) {
    if (err) {
        return console.error(err);
    }
    console.log("2.quickcheck README.md 数据写入成功！");
  });

  fs.writeFile('./docs/2.note/README.md', data,  function(err) {
    if (err) {
        return console.error(err);
    }
    console.log("3.note README.md 数据写入成功！");
  });

});


// ② 遍历 1.quickcheck 和 2.note 文件夹，生成路径导航

// 读取目录,并根据此生成规则写入 config.js中
let strOne = ''
let one = fs.readdirSync('./1.quickcheck')
one.forEach(item => {
  if (!/.md/.test(item) && item !== '.DS_Store') {

    let files2 = []
    let files2Str = ''
    fs.readdirSync(path.join('./1.quickcheck', item)).forEach( item1 => {
      files2.push(`${path.join(path.join('./1.quickcheck', item), item1)}`)
    })

    files2.forEach( item2 => {
      files2Str += `
      '${item2}',`
    })

    strOne += `
      {
        title: '${item}',
        children: [${files2Str}]
      },
    `
  }
})

let strTwo = ''
let two = fs.readdirSync('./2.note')
two.forEach(item => {
  if (!/.md/.test(item) && item !== '.DS_Store') {

    let files2 = []
    let files2Str = ''
    fs.readdirSync(path.join('./2.note', item)).forEach( item1 => {
      files2.push(`${path.join(path.join('./2.note', item), item1)}`)
    })

    files2.forEach( item2 => {
      files2Str += `
      '${item2}',`
    })

    strTwo += `
      {
        title: '${item}',
        children: [${files2Str}]
      },
    `
  }
})

// 写入
let configStr = `
module.exports = {
  title: 'Notes',
  description: '知识速查（了不起的个人工具库）',
  head: [
    ['link', { rel: 'icon', href: '/favicon.ico' }]
  ],
  themeConfig: {
    repo: 'https://github.com/zhukunpenglinyutong/notes',
    //导航
    nav: [
      { text: '速查', link: '/1.quickcheck/' },
      { text: '笔记', link: '/2.note/' }
    ],
    // 侧边栏
    sidebar: {
      '/1.quickcheck': [
        ${strOne}
      ],
      '/2.note': [
        ${strTwo}
      ]
    }
  },
  serviceWorker: true,
}
`

fs.writeFile('./docs/.vuepress/config.js', configStr,  function(err) {
  if (err) {
      return console.error(err);
  }
  console.log("1.configStr 数据写入成功！");
});
```

### 2019.6.9

##### 1.申请配置ssl证书

- 申请了ssl证书，就能让网站变为 https开头的，更安全，额，似乎比我想的简单

<img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/1.quickcheck/3.%E8%BF%90%E7%BB%B4/1.png" />
<img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/1.quickcheck/3.%E8%BF%90%E7%BB%B4/2.png" />
<img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/1.quickcheck/3.%E8%BF%90%E7%BB%B4/3.png" />

- 之后还需要进行配置：https://cloud.tencent.com/document/product/400/35244

<img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/1.quickcheck/3.%E8%BF%90%E7%BB%B4/4.png" />

- 🔥注意：主域名申请的单域名证书，二级域名不在https加密保护内，所以 notes.itzkp.com 还是 http协议，而通配符证书可以保护主域名下所有的二级子域名

于是乎我又申请了：notes.itzkp.com 和 jl.itzkp.com 的ssl证书，难点就是 二级域名的解析我是放到了，conf.d 文件夹下，我这怎么设置 ssl呢？

```sh
# 示例：在conf.d 下面的 notes.conf下

server {
	listen 443;
    server_name notes.itzkp.com; #填写绑定证书的域名
    ssl on;
    ssl_certificate 1_notes.itzkp.com_bundle.crt;#证书文件名称
    ssl_certificate_key 2_notes.itzkp.com.key;#私钥文件名称
    ssl_session_timeout 5m;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #请按照这个协议配置
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;#请按照这个套件配置
    ssl_prefer_server_ciphers on;

    location / {

      proxy_pass http://140.143.3.244:9998;
    	proxy_set_header X-Real-IP $remote_addr;
   	 	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
   	  proxy_set_header Host $http_host;
  		proxy_set_header X-Nginx-Proxy true;
  		proxy_redirect off;        
    }
}

server {
  listen 80;
  server_name notes.itzkp.com; #填写绑定证书的域名
  rewrite ^(.*)$ https://$host$1 permanent; #把http的域名请求转成https
}

```

---