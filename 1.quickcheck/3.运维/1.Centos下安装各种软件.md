# 1.Centos下安装各种软件

## 1. 安装nodejs

- 设置安装源：curl --silent --location https://rpm.nodesource.com/setup_11.x | bash -
- 安装node：yum install -y nodejs

---

## 2. 安装 MongoDB


- 创建个人仓库：vi /etc/yum.repos.d/mongodb-org-4.0.repo
- 插入文本段

[mongodb-org-4.0]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.0/x86_64/
gpgcheck=0
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-4.0.asc

注意：第一次复制粘贴文本段会造成缺失，可以全部删除重新粘贴，或者直接光标移至最前面进行输入补全

- 运行命令：yum install -y mongodb-org
- 启动mongDB：service mongod start

---

## 3. 安装Nginx

- 安装：yum install nginx
- 启动nginx：service nginx start
- 开机自启：systemctl enable nginx.service 

---

## 4. 安装 pm2

- 安装：npm install -g pm2
- 运行程序：pm2 start 程序路径
- 生成自启脚本，保持当前进程活跃：pm2 startup
- 保存当前进程状态：pm2 save

---

## 5. 安装GitLab

版本：11.9.9
- 下载rpm：wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-11.9.9-ce.0.el7.x86_64.rpm
- 安装：rpm -i gitlab-ce-11.9.9-ce.0.el7.x86_64.rpm
- 修改gitlab配置文件指定服务器ip和自定义端口 vim  /etc/gitlab/gitlab.rb
- gitlab-ctl reconfigure
- gitlab-ctl restart
- 登录：初始账户: root 密码: 5iveL!fe

> 问题：想安装中文版的，不知道怎么安装

---

## 6. 安装Docker
```
安装几个啥，添加的啥咱也不知道，跟着官网做吧

yum install -y yum-utils \
  device-mapper-persistent-data \
  lvm2

yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo


正式下载：yum install docker-ce docker-ce-cli containerd.io -y
启动：systemctl start docker
```

---

## 7.yapi安装

- 设置镜像源：npm install -g yapi-cli --registry https://registry.npm.taobao.org
- 运行Yapi部署工具：yapi server
    - （1）安装成功会有以下提示：在浏览器打开http://0.0.0.0:9090访问。。。。。。
    - （2）外网无法访问时请确认服务器是否已经开放了端口
- 访问部署工具站点
- 填写相应信息开始部署
- 修改配置

```
输入 vim /root/my-yapi/config.json

{
  "port": "3000", //外网访问端口
  "adminAccount": "yizitadmin@yizit.cn", //管理员邮箱
  "db": {
       "servername": "127.0.0.1",
       "DATABASE": "yapi",
       "port": "27017"
   },
  "mail": {
       "enable": true,
       "host": "smtp.163.com",
       "port": 465,
       "from": "可用于发送邮件的163邮箱",
       "auth": {
           "user": "163邮箱",
           "pass": "163邮箱对应的密码或授权码"
       }
  }
} 
```


- 切换到部署目录下：cd /root/my-yapi
- 启动服务：node vendors/server/app.js

---


### 多站点创建nginx的conf文件
执行sudo vi /etc/nginx/nginx.conf打开nginx默认配置文件，
在http{ }中查看是否有include /etc/nginx/conf.d/*conf；
如果没有，在http{}末尾进行添加并进行保存，然后退出编辑

注：此处conf.d为多站点conf文件存放目录

执行vim /etc/nginx/conf.d/配置文件名.conf  （建议采用域名作为配置文件名）

添加一下文本段

server {
    listen 80; 外网端口
    server_name a.com;绑定网站对应域名
 
    location / {
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   Host      $http_host;
        proxy_pass         http://127.0.0.1:8082;本地网站地址
    }
}

保存退出

注：yapi在location /添加
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection "upgrade";

---

### 安装 Jenkins 

```js

yum install java -y

yum install git -y

wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo

rpm --import https://jenkins-ci.org/redhat/jenkins-ci.org.key

yum install jenkins -y //完成之后直接使用 yum 命令安装 Jenkins

```

```js
vim /etc/sysconfig/jenkins // Jenkins 修改权限 找到$JENKINS_USER 改为 “root”:

// 然后更改执行以下命令 Jenkins home，webroot 和日志的所有权：
chown -R root:root /var/lib/jenkins
chown -R root:root /var/cache/jenkins
chown -R root:root /var/log/jenkins

service jenkins restart  //启动 jenkins

// 有一个OK表示启动成功
```


[参考](https://juejin.im/post/5b371678f265da599f68dfa2)